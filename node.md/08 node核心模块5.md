### 08 node核心模块5

##### 8.1 Events模块

> - 回调函数模式让 Node 可以处理异步操作。但是，为了适应回调函数，异步操作只能有两个状态：开始和结束。对于那些多状态的异步操作（状态1，状态2，状态3，……），回调函数就会无法处理，你不得不将异步操作拆开，分成多个阶段。每个阶段结束时，调用下一个回调函数。
> - 为了解决这个问题，Node 提供 `Event Emitter` 接口。通过事件，解决多状态异步操作的响应问题
> - `Event Emitter` 是一个接口，可以在任何对象上部署。这个接口由events模块提供。
>
> ![image-20200223171225798](..\images\image-20200223171225798.png)
>
> ![image-20200223171300205](..\images\image-20200223171300205.png)
>
> 注册事件 => 激活事件 >>>这个使用的逻辑有点类似于Vue的自定义事件
>
> ![image-20200223173026774](..\images\image-20200223173026774.png)
>
> ![image-20200223173045918](..\images\image-20200223173045918.png)
>
> - 上面代码中，`myEmitter`对象实例`emitter`就是消息中心。通过on方法为someEvent事件指定回调函数，通过`emit`方法触发`someEvent`事件。
> - 上面代码还表明，`myEmitter`对象的事件触发和监听是同步的，即只有事件的回调函数执行以后，函数fn才会继续执行。

##### 8.2 Events模块之once激活

> 该方法类似于on方法，但是回调函数只触发一次 >>>
>
> ![image-20200223173448766](..\images\image-20200223173448766.png)
>
> ![image-20200223173520518](..\images\image-20200223173520518.png)
>
> 第二次运行时,没有触发someEvent事件

##### 8.3Events模块之removeListener()

> 该方法用于移除回调函数。它接受两个参数，第一个是事件名称，第二个是回调函数名称。这就是说，**不能用于移除匿名函数**。
>
> 执行一次之后解绑 >>>
>
> ![image-20200223174628940](..\images\image-20200223174628940.png)
>
> ![image-20200223174703885](..\images\image-20200223174703885.png)
>
> 注意 >>>
>
> 1. on和removeListener的参数都是一个事件名和一个函数, 
> 2. 绑定和解绑都操作的是事件名和函数

##### 8.4 Events模块之单事件多函数绑定和解绑

> 单个事件绑定多个函数 >>>
>
> ![image-20200223192133402](..\images\image-20200223192133402.png)
>
> 解绑 >>>
>
> ![image-20200223192605284](..\images\image-20200223192605284.png)
>
> ![image-20200223192633773](..\images\image-20200223192633773.png)
>
> - 单个事件可以绑定多个函数, 每个函数被激活的顺序就是绑定的顺序
> - 同理,单个函数也可以与多个事件进行绑定

##### 8.5 Events模块之setMaxListeners()

> - Node默认允许同一个事件最多可以指定10个回调函数。
> - emitter.setMaxListeners(number)
> - 该方法可以设置回调函数的上限,超出值之后就会报出一个警告
>
> ![image-20200223193718741](..\images\image-20200223193718741.png)
>
> ![image-20200223193741202](..\images\image-20200223193741202.png)
>
> 不过也就是个警告而已, 执行还是可以执行的

##### 8.6 Events模块之清除/获取所有回调函数

> `emitter.removeAllListeners(“someEvent")` >>> 
>
> 该方法用于移除某个事件的所有回调函数。
>
> `emitter.removeAllListeners()` >>>
>
> 如果不带参数，则表示移除所有事件的所有回调函数。
>
> ![image-20200223194143392](..\images\image-20200223194143392.png)
>
> ![image-20200223194212166](..\images\image-20200223194212166.png)
>
> `emitter.listeners(“someEvent”);` >>>
>
> `listeners`方法接受一个事件名称作为参数，返回该事件所有回调函数组成的数组。
>
> ![image-20200223194922592](..\images\image-20200223194922592.png)
>
> ![image-20200223195012206](..\images\image-20200223195012206.png)

##### 8.7 Events模块之错误处理

> 事件处理过程中抛出的错误，可以使用try...catch捕获
>
> ![image-20200223200241409](..\images\image-20200223200241409.png)
>
> ![image-20200223200331315](F:\前端开发\learn node.js\images\image-20200223200331315.png)
>
> 上面的代码中 , someEvent一共绑定了三个监听函数 , 其中第二个监听函数会抛出错误
>
> 第二个监听函数抛出的错误被try...catch代码块捕获了。一旦被捕获，**该事件后面的监听函数**都不会再执行了 , 所以第三个监听函数没有执行 , 并且最后console.log输出了

##### 8.8 Events模块之事件类型

> Events模块默认支持两个事件 >>>
>
> 1. `newListener`事件：添加新的回调函数时触发。
> 2. `removeListener`事件：移除回调时触发。
>
> `newListener` >>>
>
> ![image-20200223202728843](..\images\image-20200223202728843.png)
>
> ![image-20200223202753880](..\images\image-20200223202753880.png)
>
> 添加了三个回调函数 , 该事件就触发了三次
>
> `removeListener` >>>
>
> ![image-20200223203856583](..\images\image-20200223203856583.png)
>
> ![image-20200223203953019](..\images\image-20200223203953019.png)

