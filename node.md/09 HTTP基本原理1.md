### 09 HTTP基本原理1

##### 9.1 HTTP基本原理

> Web 内容都是存储在Web 服务器上的。Web 服务器所使用的是HTTP 协议，因此经常会被称为HTTP 服务器。这些HTTP 服务器存储了因特网中的数据，如果HTTP 客户端发出请求的话，它们会提供数据。客户端向服务器发送HTTP 请求，服务器会在HTTP 响应中回送所请求的数据，HTTP 客户端(比如浏览器)和HTTP服务器共同构成了万维网的基本组件。
>
> ![image-20200223213922576](..\images\image-20200223213922576.png)

##### 9.2 IME(Multipurpose Internet Mail Extension，多用途因特网邮件扩展)

> 因特网上有数千种不同的数据类型，HTTP 仔细地给每种要通过Web 传输的对象都打上了名为MIME 类型（MIME type） 的数据格式标签。最初设计MIME（Multipurpose Internet Mail Extension，多用途因特网邮件扩展）是为了解决在不同的电子邮件系统之间搬移报文时存在的问题。MIME 在电子邮件系统中工作得非常好，因此HTTP 也采纳了它，用它来描述并标记多媒体内容。
>
> ![image-20200223214209523](..\images\image-20200223214209523.png)
>
> Web 服务器会为所有HTTP 对象数据附加一个MIME 类型当Web浏览器从服务器中取回一个对象时，会去查看相关的MIME 类型，看看它是否知道应该如何处理这个对象。大多数浏览器都可以处理数百种常见的对象类型：显示图片文件、解析并格式化HTML 文件、通过计算机声卡播放音频文件，或者运行外部插件软件来处理特殊格式的数据。
>
> MIME 类型是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分隔。
>
> - HTML 格式的文本文档由 text/html 类型来标记。
> - 普通的 ASCII 文本文档由 text/plain 类型来标记。
> - PEG 格式的图片为 image/jpeg 类型。
> - GIF 格式的图片为 image/gif 类型。
> - Apple 的 QuickTime 电影为 video/quicktime 类型。
> - 微软的 PowerPoint 演示文件为 application/vnd.ms-powerpoint 类型。
>
> https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Complete_list_of_MIME_types
> MIME的类型值, 有数百种, 只需了解即可, 无需记忆

##### 9.3 网络地址的基本信息

> 每个Web 服务器资源都有一个名字，这样客户端就可以说明它们感兴趣的资源是什么了。服务器资源名被称为统一资源标识符（Uniform Resource Identifier，URI）。URI 就像因特网上的邮政地址一样，在世界范围内唯一标识并定位信息资源。
>
> ![image-20200223214608970](..\images\image-20200223214608970.png)
>
> 统一资源定位符（URL）是资源标识符最常见的形式。URL 描述了一台特定服务器上某资源的特定位置。它们可以明确说明如何从一个精确、固定的位置获取资源。
>
> 大部分URL 都遵循一种标准格式，这种格式包含三个部分。
>
> - URL 的第一部分被称为方案（scheme），说明了访问资源所使用的协议类型。这
> - 部分通常就是HTTP 协议（http://）。
>   第二部分给出了服务器的因特网地址（比如，www.joes-hardware.com）。
> - 其余部分指定了 Web 服务器上的某个资源（比如，/specials/saw-blade.gif）。
>   现在，几乎所有的URI 都是URL。
>
> ![image-20200223215110061](..\images\image-20200223215110061.png)

##### 9.4 HTTP请求的事务逻辑

> 一个HTTP 事务由一条（从客户端发往服务器的）请求命令和一个（从服务器发回客户端的）响应结果组成。这种通信是通过名为HTTP 报文（HTTP message）的格式化数据块进行的
>
> ![image-20200223215214983](..\images\image-20200223215214983.png)

##### 9.5 报文 

> HTTP 报文是由一行一行的简单字符串组成的。HTTP 报文都是纯文本，不是二进制代码，所以人们可以很方便地对其进行读写
>
> ![image-20200223215800652](..\images\image-20200223215800652.png)
>
> 从Web 客户端发往Web 服务器的HTTP 报文称为请求报文（request message）。从服务器发往客户端的报文称为响应报文（response message）
>
> ![image-20200223220551644](..\images\image-20200223220551644.png)
>
> HTTP 报文包括以下三个部分。
>
> 1. 起始行 >>> 报文的第一行就是起始行，在请求报文中用来说明要做些什么，在响应报文中说明出现了什么情况。
> 2. 首部字段 >>> 起始行后面有零个或多个首部字段。每个首部字段都包含一个名字和一个值，为了便于解析，两者之间用冒号（:）来分隔。首部以一个空行结束。添加一个首部字段和添加新行一样简单。
> 3. 主体 >>> 空行之后就是可选的报文主体了，其中包含了所有类型的数据。请求主体中包括了要发送给Web 服务器的数据；响应主体中装载了要返回给客户端的数据。起始行和首部都是文本形式且都是结构化的，而主体则不同，主体中可以包含任意的二进制数据（比如图片、视频、音轨、软件程序）。当然，主体中也可以包含文本。

##### 9.6 连接

> HTTP 是个应用层协议。HTTP 无需操心网络通信的具体细节；它把联网的细节都交给了通用、可靠的因特网传输协议TCP/IP。只要建立了TCP 连接，客户端和服务器之间的报文交换就不会丢失、不会被破坏，也不会在接收时出现错序了(理论上而已)
>
> TCP提供了 :
>
> 1. 无差错的数据传输；
> 2. 按序传输（数据总是会按照发送的顺序到达）；
> 3. 未分段的数据流（可以在任意时刻以任意尺寸将数据发送出去）
>
> ![image-20200224142436239](..\images\image-20200224142436239.png)
>
> 用网络术语来说，HTTP 协议位于TCP 的上层。HTTP 使用TCP 来传输其报文数据。
>
> 在HTTP 客户端向服务器发送报文之前，需要用网际协议（Internet Protocol，IP）地址和端口号在客户端和服务器之间建立一条TCP/IP 连接
>
> ![image-20200224144716565](..\images\image-20200224144716565.png)
>
> 步骤如下 >>>
>
> 1. 浏览器从URL 中解析出服务器的主机名；
> 2. 浏览器将服务器的主机名转换成服务器的IP 地址；
> 3. 浏览器将端口号（如果有的话）从URL 中解析出来；
> 4. 浏览器建立一条与Web 服务器的TCP 连接；
> 5. 浏览器向服务器发送一条HTTP 请求报文；
> 6. 服务器向浏览器回送一条HTTP 响应报文；
> 7. 关闭连接，浏览器显示文档

##### 9.7 TCP/IP的三次握手和四次挥手

> 客户端和服务端通信前要进行连接，“3次握手”的作用就是双方都能明确自己和对方的收、发能力是正常的。
>
> ![image-20200224145326915](..\images\image-20200224145326915.png)
>
> 当客户端与服务器端关闭一个链接通道时,同样需要双方的确认才行, 这个确认的过程需要四个步骤. 与建立连接只能是客户端向服务端发送不同, 关闭链接可以有任意一方发起
>
> ![image-20200224151223754](..\images\image-20200224151223754.png)

##### 9.8 常见业务结构组件

> 代理 >>>
>
> ![image-20200224152713126](..\images\image-20200224152713126.png)
>
> 代理位于客户端和服务器之间，接收所有客户端的HTTP 请求，并将这些请求转发给服务器（可能会对请求进行修改之后转发）。最常见的有一些绿坝(青少年网页内容过滤系统)或是VPN
>
> 缓存 >>>
>
> ![image-20200224152754203](..\images\image-20200224152754203.png)
>
> Web 缓存（Web cache）或代理缓存（proxy cache）是一种特殊的HTTP 代理服务器，可以将经过代理传送的常用文档复制保存起来。下一个请求同一文档的客户端就可以享受缓存的私有副本所提供的服务了(比如本地的浏览器缓存)
>
> 网关 >>>
>
> 网关（gateway）是一种特殊的服务器，作为其他服务器的中间实体使用。通常用于将HTTP 流量转换成其他的协议。网关接受请求时就好像自己是资源的源端服务器一样。客户端可能并不知道自己正在与一个网关进行通信。
>
> ![image-20200224152858335](..\images\image-20200224152858335.png)
>
> 例: 一个HTTP/FTP 网关会通过HTTP 请求接收对FTP URI 的请求，但通过FTP协议来获取文档。得到的文档会被封装成一条HTTP 报文，发送给客户端
>
> 隧道 >>>
>
> ![image-20200224152925095](..\images\image-20200224152925095.png)
>
> 隧道（tunnel）是建立起来之后，就会在两条连接之间对原始数据进行盲转发(只负责转发数据但是不管转发的是啥)的HTTP 应用程序。HTTP 隧道通常用来在一条或多条HTTP 连接上转发非HTTP 数据，转发时不会窥探数据