### 07 node核心模块4

##### 7.1 fs模块

> `fs`是`filesystem`的缩写，该模块提供本地文件的读写能力，基本上是`POSIX`文件操作命令的简单包装。
>
> ![image-20200223141447244](..\images\image-20200223141447244.png)
>
> ![image-20200223141359083](..\images\image-20200223141359083.png)
>
> ![image-20200223141423865](..\images\image-20200223141423865.png)
>
> fs模块的功能非常丰富. 并且，这个模块几乎对所有操作提供异步和同步两种操作方式，供开发者选择。

##### 7.2 fs模块之readFile()

> `readFile`方法用于异步读取数据。
>
> ![image-20200223142049880](..\images\image-20200223142049880.png)
>
> ![image-20200223141908771](..\images\image-20200223141908771.png)
>
> ![image-20200223142011548](..\images\image-20200223142011548.png)
>
> - `readFile`方法的第一个参数是文件的路径，可以是绝对路径，也可以是相对路径。注意，如果是相对路径，是相对于当前进程所在的路径（`process.cwd()`），而不是相对于当前脚本所在的路径。
> - `readFile`方法的第二个参数是读取完成后的回调函数。该函数的第一个参数是发生错误时的错误对象，第二个参数是代表文件内容的`Buffer`实例。

##### 7.3 fs模块之readFileSync()

> `readFileSync`方法用于同步读取数据。
>
> ![image-20200223144224981](..\images\image-20200223144224981.png)
>
> ![image-20200223144247794](..\images\image-20200223144247794.png)
>
> `readFileSync`方法的第一个参数是文件路径，第二个参数可以是一个表示配置的对象，也可以是一个表示文本文件编码的字符串。默认的配置对象是{ encoding: null, flag: 'r' }，即文件编码默认为null，读取模式默认为r（只读）。如果第二个参数不指定编码（encoding），readFileSync方法返回一个Buffer实例，否则返回的是一个字符串。
>
> 同步/异步辨析:
>
> 1. 同步操作会阻塞后面的代码, 后面的代码必须等待同步操作完成后方可执行;异步操作会先执行后面的代码, 等异步操作完成了就回头执行回调函数
> 2. 同步操作的结果直接作为一个值赋给变量
> 3. 异步操作必须有一个回调函数, 回调函数的第一个参数都是错误对象
> 4. 大多数node的异步api都有一个同步版本, api名称就是异步api+Sync

##### 7.4 fs模块之writeFile方法

> `writeFile`方法用于异步写入文件。(默认直接覆盖)
>
> `fs.writeFile(file, data[, options], callback)`
>
> ![image-20200223152911527](..\images\image-20200223152911527.png)
>
> ![image-20200223152934536](..\images\image-20200223152934536.png)
>
> ![image-20200223153009875](..\images\image-20200223153009875.png)
>
> 文件标识系统 >>> 
>
> 当 flag 选项采用字符串时，可用以下标志：
>
> 1. 'a' - 打开文件用于追加。如果文件不存在，则创建该文件。
> 2. 'ax' - 与 'a' 相似，但如果路径已存在则失败。
> 3. 'a+' - 打开文件用于读取和追加。如果文件不存在，则创建该文件。
> 4. 'ax+' - 与 'a+' 相似，但如果路径已存在则失败。
> 5. 'as' - 以同步模式打开文件用于追加。如果文件不存在，则创建该文件。
> 6. 'as+' - 以同步模式打开文件用于读取和追加。如果文件不存在，则创建该文件。
> 7. 'r' - 打开文件用于读取。如果文件不存在，则出现异常。
> 8. 'r+' - 打开文件用于读取和写入。如果文件不存在，则出现异常。
> 9. 'rs+' - 以同步模式打开文件用于读取和写入。指示操作系统绕过本地的文件系统缓存。
> 10. 这对于在 NFS 挂载上打开文件时非常有用，因为它允许跳过可能过时的本地缓存。 它对 I/O 性能有非常实际的影响，因此除非需要，否则不建议使用此标志。
> 11. 这不会将 fs.open() 或 fsPromises.open() 转换为同步的阻塞调用。 如果需要同步的操作，则应使用 fs.openSync() 之类的。
> 12. ‘w’ - 打开文件用于写入。如果文件不存在则创建文件，如果文件已存在则覆盖文件。
> 13. 'wx' - 与 'w' 相似，但如果路径已存在则失败。
> 14. 'w+' - 打开文件用于读取和写入。如果文件不存在则创建文件，如果文件已存在则截断文件。
> 15. 'wx+' - 与 'w+' 相似，但如果路径已存在则失败。

##### 7.5 fs模块之exists(path, callback)

> `exists`方法用来判断给定路径是否存在，然后不管结果如何，都会调用回调函数
>
> ![image-20200223154649635](..\images\image-20200223154649635.png)
>
> ![image-20200223154709556](..\images\image-20200223154709556.png)
>
> 回调函数的参数是一个表示文件是否存在的布尔值

##### 7.6 fs模块之mkdir()/readdir()

> - mkdir方法用于新建目录
> - mkdir接受三个参数，第一个是目录名，第二个是权限值，第三个是回调函数
>
> ![image-20200223160406686](..\images\image-20200223160406686.png)
>
> 运行后 >>>
>
> ![image-20200223160441649](..\images\image-20200223160441649.png)
>
> `readdir`方法用于读取目录，返回一个所包含的文件和子目录名字的数组
>
> ![image-20200223160659888](..\images\image-20200223160659888.png)
>
> `process.cwd`是指当前进程所在的目录
>
> ![image-20200223160731131](..\images\image-20200223160731131.png)

##### 7.7 fs模块之stat

> - 当我们获得了目录或是文件信息后,要进行使用,那么就得判断一下这个信息时目录还是文件名,不然直接调用readfile必然会出现访问失败的情况
> - stat方法的参数是一个文件或目录，它产生一个对象，该对象包含了该文件或目录的具体信息。我们往往通过该方法，判断正在处理的到底是一个文件，还是一个目录。
>
> ![image-20200223161817816](..\images\image-20200223161817816.png)
>
> ![image-20200223161837652](..\images\image-20200223161837652.png)

##### 7.8 fs模块之watchfile/unwatchfile()

> `watchfile`方法监听一个文件，如果该文件发生变化，就会自动触发回调函数
>
> ![image-20200223163505798](..\images\image-20200223163505798.png)
>
> ![image-20200223163547512](..\images\image-20200223163547512.png)
>
> ![image-20200223163609984](..\images\image-20200223163609984.png)
>
> 这里的文件变化, 分为通过代码修改文件和手动修改文件
>
> `unwatchfile`方法用于解除对文件的监听。